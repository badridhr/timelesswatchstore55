<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Simple - Gestion des Produits</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; padding: 20px; }
        .admin-container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-bottom: 20px; color: #333; }
        h2 { margin: 30px 0 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        textarea { height: 80px; resize: vertical; }
        button { background: #D4AF37; color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background: #b8941f; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 4px; color: white; font-weight: bold; z-index: 1000; }
        .success { background: #28a745; }
        .error { background: #dc3545; }
        
        /* Styles pour la section de visualisation des produits */
        .products-section { margin-top: 40px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9; }
        .product-image { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .product-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .product-brand { color: #666; margin-bottom: 5px; }
        .product-price { font-weight: bold; color: #D4AF37; margin-bottom: 5px; }
        .product-old-price { text-decoration: line-through; color: #999; margin-bottom: 5px; }
        .product-stock { margin-bottom: 10px; }
        .product-actions { display: flex; gap: 10px; }
        .edit-btn { background: #007bff; }
        .edit-btn:hover { background: #0056b3; }
        .delete-btn { background: #dc3545; }
        .delete-btn:hover { background: #c82333; }
        
        /* Modal pour l'édition */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-btn { font-size: 24px; cursor: pointer; }
        
        /* Filtres */
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filters select, .filters input { flex: 1; min-width: 150px; }
        
        @media (max-width: 768px) {
            .products-grid { grid-template-columns: 1fr; }
            .filters { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>Gestion des Produits</h1>
        
        <!-- Section d'ajout de produit -->
        <section>
            <h2>Ajouter un Produit</h2>
            <form id="productForm">
                <div class="form-group">
                    <label>Nom du produit:</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Marque:</label>
                    <input type="text" id="productBrand" required>
                </div>
                <div class="form-group">
                    <label>Catégorie:</label>
                    <select id="productCategory" required>
                        <option value="">Choisir...</option>
                        <option value="Homme">Homme</option>
                        <option value="Femme">Femme</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Prix (DZD):</label>
                    <input type="number" id="productPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Ancien prix (DZD) - Optionnel:</label>
                    <input type="number" id="productOldPrice" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Stock:</label>
                    <input type="number" id="productStock" min="0" value="1" required>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="productDescription" placeholder="Description du produit..."></textarea>
                </div>
                <div class="form-group">
                    <label>URLs des images (3 max, séparées par des virgules):</label>
                    <textarea id="productImages" placeholder="https://exemple.com/image1.jpg, https://exemple.com/image2.jpg, https://exemple.com/image3.jpg"></textarea>
                </div>
                <button type="submit">Ajouter le Produit</button>
            </form>
        </section>
        
        <!-- Section de visualisation des produits -->
        <section class="products-section">
            <h2>Produits Ajoutés</h2>
            
            <!-- Filtres -->
            <div class="filters">
                <select id="categoryFilter">
                    <option value="">Toutes les catégories</option>
                    <option value="Homme">Homme</option>
                    <option value="Femme">Femme</option>
                </select>
                <input type="text" id="searchFilter" placeholder="Rechercher un produit...">
            </div>
            
            <!-- Grille des produits -->
            <div class="products-grid" id="productsGrid">
                <!-- Les produits seront ajoutés ici dynamiquement -->
            </div>
        </section>
    </div>
    
    <!-- Modal pour l'édition -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier le Produit</h2>
                <span class="close-btn" id="closeModal">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label>Nom du produit:</label>
                    <input type="text" id="editProductName" required>
                </div>
                <div class="form-group">
                    <label>Marque:</label>
                    <input type="text" id="editProductBrand" required>
                </div>
                <div class="form-group">
                    <label>Catégorie:</label>
                    <select id="editProductCategory" required>
                        <option value="Homme">Homme</option>
                        <option value="Femme">Femme</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Prix (DZD):</label>
                    <input type="number" id="editProductPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Ancien prix (DZD) - Optionnel:</label>
                    <input type="number" id="editProductOldPrice" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Stock:</label>
                    <input type="number" id="editProductStock" min="0" required>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="editProductDescription" placeholder="Description du produit..."></textarea>
                </div>
                <div class="form-group">
                    <label>URLs des images (3 max, séparées par des virgules):</label>
                    <textarea id="editProductImages" placeholder="https://exemple.com/image1.jpg, https://exemple.com/image2.jpg, https://exemple.com/image3.jpg"></textarea>
                </div>
                <button type="submit">Enregistrer les modifications</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBB8zPrG4MjAqBm1SOxIFQdWtiCmz_v92s",
            authDomain: "luxur-6b128.firebaseapp.com",
            projectId: "luxur-6b128",
            storageBucket: "luxur-6b128.firebasestorage.app",
            messagingSenderId: "900453735371",
            appId: "1:900453735371:web:e32188ac6ea261084c344e"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Références aux éléments DOM
        const productsGrid = document.getElementById('productsGrid');
        const editModal = document.getElementById('editModal');
        const closeModal = document.getElementById('closeModal');
        const editForm = document.getElementById('editForm');
        const categoryFilter = document.getElementById('categoryFilter');
        const searchFilter = document.getElementById('searchFilter');

        // Variables globales
        let products = [];
        let currentEditId = null;

        // Gérer la soumission du formulaire d'ajout
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addProduct();
        });

        // Gérer la soumission du formulaire d'édition
        editForm.addEventListener('submit', function(e) {
            e.preventDefault();
            updateProduct();
        });

        // Fermer le modal
        closeModal.addEventListener('click', function() {
            editModal.style.display = 'none';
        });

        // Fermer le modal en cliquant à l'extérieur
        window.addEventListener('click', function(e) {
            if (e.target === editModal) {
                editModal.style.display = 'none';
            }
        });

        // Écouter les changements de filtre
        categoryFilter.addEventListener('change', filterProducts);
        searchFilter.addEventListener('input', filterProducts);

        // Fonction pour ajouter un produit
        function addProduct() {
            // Récupérer les URLs des images
            const imagesInput = document.getElementById('productImages').value;
            const images = imagesInput.split(',').map(url => url.trim()).filter(url => url.length > 0);
            
            const productData = {
                name: document.getElementById('productName').value,
                brand: document.getElementById('productBrand').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                oldPrice: document.getElementById('productOldPrice').value ? parseFloat(document.getElementById('productOldPrice').value) : null,
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value,
                images: images,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Ajouter le produit à Firebase
            db.collection('products').add(productData)
                .then(() => {
                    showNotification('Produit ajouté avec succès!', 'success');
                    document.getElementById('productForm').reset();
                    loadProducts(); // Recharger la liste des produits
                })
                .catch((error) => {
                    console.error('Erreur:', error);
                    showNotification('Erreur lors de l\'ajout du produit', 'error');
                });
        }

        // Fonction pour charger les produits
        function loadProducts() {
            db.collection('products').orderBy('createdAt', 'desc').get()
                .then((querySnapshot) => {
                    products = [];
                    querySnapshot.forEach((doc) => {
                        products.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    displayProducts(products);
                })
                .catch((error) => {
                    console.error('Erreur lors du chargement des produits:', error);
                    showNotification('Erreur lors du chargement des produits', 'error');
                });
        }

        // Fonction pour afficher les produits
        function displayProducts(productsToDisplay) {
            productsGrid.innerHTML = '';
            
            if (productsToDisplay.length === 0) {
                productsGrid.innerHTML = '<p>Aucun produit trouvé.</p>';
                return;
            }
            
            productsToDisplay.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                // Image principale ou placeholder
                const mainImage = product.images && product.images.length > 0 ? 
                    product.images[0] : 'https://via.placeholder.com/300x200?text=No+Image';
                
                // Formatage du prix
                const priceFormatted = new Intl.NumberFormat('fr-DZ', {
                    style: 'currency',
                    currency: 'DZD'
                }).format(product.price);
                
                const oldPriceFormatted = product.oldPrice ? 
                    new Intl.NumberFormat('fr-DZ', {
                        style: 'currency',
                        currency: 'DZD'
                    }).format(product.oldPrice) : '';
                
                productCard.innerHTML = `
                    <img src="${mainImage}" alt="${product.name}" class="product-image">
                    <div class="product-name">${product.name}</div>
                    <div class="product-brand">${product.brand}</div>
                    <div class="product-category">${product.category}</div>
                    <div class="product-price">${priceFormatted}</div>
                    ${product.oldPrice ? `<div class="product-old-price">${oldPriceFormatted}</div>` : ''}
                    <div class="product-stock">Stock: ${product.stock}</div>
                    <div class="product-actions">
                        <button class="edit-btn" onclick="openEditModal('${product.id}')">Modifier</button>
                        <button class="delete-btn" onclick="deleteProduct('${product.id}')">Supprimer</button>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }

        // Fonction pour ouvrir le modal d'édition
        function openEditModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentEditId = productId;
            
            // Remplir le formulaire avec les données du produit
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductBrand').value = product.brand;
            document.getElementById('editProductCategory').value = product.category;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductOldPrice').value = product.oldPrice || '';
            document.getElementById('editProductStock').value = product.stock;
            document.getElementById('editProductDescription').value = product.description || '';
            document.getElementById('editProductImages').value = product.images ? product.images.join(', ') : '';
            
            // Afficher le modal
            editModal.style.display = 'block';
        }

        // Fonction pour mettre à jour un produit
        function updateProduct() {
            if (!currentEditId) return;
            
            // Récupérer les URLs des images
            const imagesInput = document.getElementById('editProductImages').value;
            const images = imagesInput.split(',').map(url => url.trim()).filter(url => url.length > 0);
            
            const updatedData = {
                name: document.getElementById('editProductName').value,
                brand: document.getElementById('editProductBrand').value,
                category: document.getElementById('editProductCategory').value,
                price: parseFloat(document.getElementById('editProductPrice').value),
                oldPrice: document.getElementById('editProductOldPrice').value ? 
                    parseFloat(document.getElementById('editProductOldPrice').value) : null,
                stock: parseInt(document.getElementById('editProductStock').value),
                description: document.getElementById('editProductDescription').value,
                images: images,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('products').doc(currentEditId).update(updatedData)
                .then(() => {
                    showNotification('Produit modifié avec succès!', 'success');
                    editModal.style.display = 'none';
                    loadProducts(); // Recharger la liste des produits
                })
                .catch((error) => {
                    console.error('Erreur lors de la modification:', error);
                    showNotification('Erreur lors de la modification du produit', 'error');
                });
        }

        // Fonction pour supprimer un produit
        function deleteProduct(productId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                db.collection('products').doc(productId).delete()
                    .then(() => {
                        showNotification('Produit supprimé avec succès!', 'success');
                        loadProducts(); // Recharger la liste des produits
                    })
                    .catch((error) => {
                        console.error('Erreur lors de la suppression:', error);
                        showNotification('Erreur lors de la suppression du produit', 'error');
                    });
            }
        }

        // Fonction pour filtrer les produits
        function filterProducts() {
            const category = categoryFilter.value;
            const searchTerm = searchFilter.value.toLowerCase();
            
            let filteredProducts = products;
            
            // Filtrer par catégorie
            if (category) {
                filteredProducts = filteredProducts.filter(product => product.category === category);
            }
            
            // Filtrer par terme de recherche
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) || 
                    product.brand.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm)
                );
            }
            
            displayProducts(filteredProducts);
        }

        // Afficher une notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Charger les produits au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });
    </script>
</body>
</html>